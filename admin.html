<script>
    // Configuration de la date automatique au format AAAA-MM-JJ
    window.onload = function() {
        const aujourdhui = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = aujourdhui;
    };

    function genererJSON() {
        const id = document.getElementById('id').value;
        // On force le titre en MAJUSCULES ici
        const titre = document.getElementById('titre').value.toUpperCase();
        const categorie = document.getElementById('categorie').value.toUpperCase();
        const image = document.getElementById('image').value;
        const texte = document.getElementById('texte').value;
        const date = document.getElementById('date').value;

        if(!id || !titre || !texte || !date) {
            alert("Remplis tous les champs mon ami !");
            return;
        }

        const nouveauMessage = {
            "id": parseInt(id),
            "titre": titre,
            "categorie": categorie,
            "image": image,
            "texte": texte,
            "date": date
        };

        // Récupérer la réserve actuelle
        let reserve = JSON.parse(localStorage.getItem('reserve_emmanuel') || '[]');
        
        // Ajouter au début de la liste
        reserve.unshift(nouveauMessage);
        
        // Sauvegarder
        localStorage.setItem('reserve_emmanuel', JSON.stringify(reserve));
        
        afficherReserve();
        
        // Préparer l'ID suivant automatiquement
        document.getElementById('id').value = parseInt(id) + 1;
        document.getElementById('titre').value = "";
        document.getElementById('image').value = "";
        document.getElementById('texte').value = "";
    }

    function afficherReserve() {
        const reserve = JSON.parse(localStorage.getItem('reserve_emmanuel') || '[]');
        const zoneNoire = document.getElementById('resultat-json');
        
        if(reserve.length > 0) {
            // Affiche le JSON propre pour le copier-coller
            zoneNoire.value = JSON.stringify(reserve, null, 2);
        }
    }

    function viderReserve() {
        if(confirm("Veux-tu vraiment vider ta réserve ?")) {
            localStorage.removeItem('reserve_emmanuel');
            document.getElementById('resultat-json').value = "";
            location.reload();
        }
    }
    
    // Charger la réserve au démarrage
    afficherReserve();
</script>
