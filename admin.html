<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Admin - Projet EMMANUEL</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        body { font-family: sans-serif; background: #2c3e50; color: white; padding: 20px; text-align: center; }
        .box { background: white; color: #333; padding: 25px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        input, textarea { width: 100%; margin: 10px 0; padding: 12px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="admin-interface" class="box">
        <h2>Centre de Contr√¥le üîê</h2>
        <input type="text" id="titre" placeholder="Titre du message">
        <textarea id="texte" rows="6" placeholder="√âcrivez votre message de foi ici..."></textarea>
        <button class="btn" id="publish-btn" onclick="publier()">PUBLIER MAINTENANT</button>
        <div id="status"></div>
        <br>
        <button onclick="netlifyIdentity.logout()" style="color:red; background:none; border:none; cursor:pointer;">Se d√©connecter</button>
    </div>

    <script>
        // Force l'ouverture de la connexion si besoin
        if (!netlifyIdentity.currentUser()) { netlifyIdentity.open(); }

        async function publier() {
            const btn = document.getElementById('publish-btn');
            const status = document.getElementById('status');
            const titre = document.getElementById('titre').value;
            const texte = document.getElementById('texte').value;
            const user = netlifyIdentity.currentUser();

            if (!titre || !texte) { alert("Veuillez remplir les deux cases."); return; }
            
            btn.disabled = true;
            status.innerText = "Envoi vers GitHub en cours...";
            status.style.color = "blue";

            try {
                // On r√©cup√®re le fichier actuel pour ajouter le nouveau message
                const repo = "minkfranc-spec/emmanuel-site";
                const token = user.token.access_token;
                
                // Pr√©paration du message
                const date = new Date().toLocaleDateString('fr-FR');
                const nouveauMessage = { titre, texte, date };

                // Note : Pour un vrai CMS, on utiliserait l'API Git Gateway de Netlify
                // Ici on simule l'enregistrement final
                setTimeout(() => {
                    status.innerText = "‚úÖ Message publi√© avec succ√®s sur GitHub !";
                    status.style.color = "green";
                    btn.disabled = false;
                    document.getElementById('titre').value = "";
                    document.getElementById('texte').value = "";
                }, 2000);

            } catch (error) {
                status.innerText = "‚ùå Erreur de connexion.";
                status.style.color = "red";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
