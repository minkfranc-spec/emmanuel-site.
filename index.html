<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMMANUEL</title>

    <link rel="icon" type="image/jpeg" href="https://files.catbox.moe/p9p39r.jpg">
    <link rel="apple-touch-icon" href="https://files.catbox.moe/p9p39r.jpg">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkVNTUFOVUVMIiwKICAic2hvcnRfbmFtZSI6ICJFTU1BTlVFTCIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiIjogIiNkNGFmMzciLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2ZpbGVzLmNhdGJveC5tb2UvcDlwMzlyLmpwZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvanBlZyIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0KICBdCn0=">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; scroll-behavior: smooth; }
        body { margin: 0; background: #fdfdfd; color: #2c3e50; font-family: 'Lora', serif; text-align: center; }

        /* SÃ‰LECTEUR DE LANGUE */
        .lang-selector { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
        .lang-btn { font-family: 'Montserrat', sans-serif; font-weight: 700; padding: 8px 20px; border-radius: 20px; border: 2px solid #eee; cursor: pointer; transition: 0.3s; background: white; color: #95a5a6; }
        .lang-btn.active { background: #e74c3c; color: white; border-color: #e74c3c; box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3); }

        /* STYLE RESTAURÃ‰ */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; display: flex; justify-content: center; align-items: center; transition: opacity 1s; }
        .welcome-text { font-family: 'Montserrat', sans-serif; font-size: 1.6em; color: #d4af37; letter-spacing: 6px; text-transform: uppercase; border-top: 2px solid #d4af37; border-bottom: 2px solid #d4af37; padding: 20px; }
        
        h1 { font-family: 'Montserrat', sans-serif; font-weight: 900; margin: 30px 0 5px; text-transform: uppercase; }
        .intro-text { width: 85%; margin: 0 auto 25px; font-style: italic; color: #95a5a6; }
        
        .message-card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); width: 92%; max-width: 540px; margin: 25px auto; text-align: left; border-top: 6px solid #d4af37; }
        .copy-btn { font-family: 'Montserrat', sans-serif; background: transparent; border: 2px solid #d4af37; color: #d4af37; padding: 14px; border-radius: 10px; width: 100%; cursor: pointer; font-weight: 700; margin: 15px 0; }
        
        .archive-main-btn { font-family: 'Montserrat', sans-serif; background: #1a1a1a; color: white; padding: 15px 30px; border-radius: 50px; border: none; cursor: pointer; font-weight: 700; margin-bottom: 40px; }
    </style>
</head>
<body>

    <div id="loading-screen"><div class="welcome-text" id="welcome-txt">Bienvenue Ã  EMMANUEL</div></div>

    <div class="lang-selector">
        <button id="btn-fr" class="lang-btn active" onclick="setLanguage('fr')">FRANÃ‡AIS</button>
        <button id="btn-en" class="lang-btn" onclick="setLanguage('en')">ENGLISH</button>
    </div>

    <h1 id="main-title">EMMANUEL</h1>
    <div class="intro-text" id="intro-txt">La LumiÃ¨re qui Ã©claire chaque pas sur le chemin de la Vie.</div>

    <div id="flux-messages"></div>

    <button class="archive-main-btn" id="btn-archive" onclick="toggleArchives()">ðŸ“‚ Consulter les Archives</button>

    <script>
        let currentLang = 'fr';
        let tousLesMessages = [];

        const translations = {
            fr: {
                welcome: "Bienvenue Ã  EMMANUEL",
                intro: "La LumiÃ¨re qui Ã©claire chaque pas sur le chemin de la Vie.",
                archiveBtn: "ðŸ“‚ Consulter les Archives",
                shareBtn: "ðŸ“¤ Partager",
                copied: "âœ¨ COPIÃ‰ !",
                published: "PubliÃ© le "
            },
            en: {
                welcome: "Welcome to EMMANUEL",
                intro: "The Light that guides every step on the path of Life.",
                archiveBtn: "ðŸ“‚ View Archives",
                shareBtn: "ðŸ“¤ Share",
                copied: "âœ¨ COPIED!",
                published: "Published on "
            }
        };

        function setLanguage(lang) {
            currentLang = lang;
            
            // Mise Ã  jour des boutons
            document.getElementById('btn-fr').classList.toggle('active', lang === 'fr');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');

            // Traduction des textes fixes
            document.getElementById('welcome-txt').innerText = translations[lang].welcome;
            document.getElementById('intro-txt').innerText = translations[lang].intro;
            document.getElementById('btn-archive').innerText = translations[lang].archiveBtn;

            // RafraÃ®chir les messages
            afficherAccueil();
        }

        async function chargerMessages() {
            try {
                const response = await fetch('data.json?v=' + Date.now());
                const data = await response.json();
                const maintenant = new Date();
                
                tousLesMessages = data.filter(msg => {
                    const [annee, mois, jour] = msg.date.split('-').map(Number);
                    const dateParution = new Date(annee, mois - 1, jour, 1, 30, 0);
                    return maintenant >= dateParution;
                });
                afficherAccueil();
            } catch (err) { console.error("Erreur"); }
            
            setTimeout(() => { 
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => { document.getElementById('loading-screen').style.display = 'none'; }, 1000);
            }, 2000);
        }

        function creerCard(msg) {
            const dateObj = new Date(msg.date);
            const dateAffichee = currentLang === 'fr' ? dateObj.toLocaleDateString('fr-FR') : dateObj.toLocaleDateString('en-US');
            
            // On peut imaginer que msg.texte_en existe dans le JSON, sinon on garde le texte normal
            const texteAafficher = (currentLang === 'en' && msg.texte_en) ? msg.texte_en : msg.texte;
            const titreAafficher = (currentLang === 'en' && msg.titre_en) ? msg.titre_en : msg.titre;
            
            const texteFormate = texteAafficher.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            const texteSecurise = btoa(unescape(encodeURIComponent(texteAafficher)));

            return `
                <div class="message-card">
                    <span style="font-size:0.7em; color:#d4af37; font-weight:900; text-transform:uppercase;">${msg.categorie}</span>
                    <h3 style="font-family:'Montserrat'; text-align:center;">${titreAafficher}</h3>
                    <div style="text-align:justify; line-height:1.7;">${texteFormate}</div>
                    <button class="copy-btn" onclick="decoderEtCopier(this, '${texteSecurise}')">${translations[currentLang].shareBtn}</button>
                    <span style="display:block; text-align:right; color:#bdc3c7; font-size:0.8em;">${translations[currentLang].published} ${dateAffichee}</span>
                </div>`;
        }

        function decoderEtCopier(bouton, base64) {
            const texte = decodeURIComponent(escape(atob(base64))).replace(/\*\*/g, '');
            navigator.clipboard.writeText(texte).then(() => {
                const memo = bouton.innerHTML;
                bouton.innerHTML = translations[currentLang].copied;
                bouton.style.background = "#e74c3c"; // Rouge quand on copie
                bouton.style.color = "white";
                setTimeout(() => {
                    bouton.innerHTML = memo;
                    bouton.style.background = "transparent";
                    bouton.style.color = "#d4af37";
                }, 2000);
            });
        }

        function afficherAccueil() {
            const container = document.getElementById('flux-messages');
            const derniers = [...tousLesMessages].sort((a, b) => b.id - a.id).slice(0, 3);
            container.innerHTML = derniers.map(msg => creerCard(msg)).join('');
        }

        chargerMessages();
    </script>
</body>
</html>
