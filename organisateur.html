<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>EMMANUEL | Organisateur & D√©tecteur</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: sans-serif; background: #fdfdfd; padding: 20px; text-align: center; color: #1a1a1a; }
        .box { max-width: 950px; margin: auto; background: white; padding: 35px; border-radius: 20px; border-top: 10px solid #d4af37; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { font-family: 'Montserrat', sans-serif; text-transform: uppercase; letter-spacing: 2px; }
        textarea { width: 100%; height: 450px; font-family: 'Courier New', monospace; padding: 15px; border: 2px solid #eee; border-radius: 10px; background: #fafafa; font-size: 14px; box-sizing: border-box; }
        .btn { background: #1a1a1a; color: white; padding: 18px 45px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 25px; transition: 0.3s; }
        .btn:hover { background: #d4af37; transform: scale(1.02); }
        .error-zone { display: none; margin-top: 25px; padding: 20px; background: #fff5f5; border-left: 6px solid #ff4d4d; color: #b91c1c; text-align: left; border-radius: 8px; font-size: 14px; }
        .guide { font-size: 0.9em; color: #666; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="box">
    <h1>üèõÔ∏è Organisateur de la Parole</h1>
    <p class="guide">Collez votre JSON ci-dessous. Le script calculera les dates et ID √† partir du message du bas.</p>
    
    <textarea id="jsonContent" placeholder="Collez votre code ici..."></textarea>
    
    <button class="btn" onclick="lancerCalcul()">‚ö° SYNCHRONISER LA CHRONOLOGIE</button>
    
    <div id="displayError" class="error-zone"></div>
</div>

<script>
function lancerCalcul() {
    const zoneTexte = document.getElementById('jsonContent');
    const zoneErreur = document.getElementById('displayError');
    zoneErreur.style.display = 'none';

    try {
        // Lecture du JSON brut
        let data = JSON.parse(zoneTexte.value);

        if (!Array.isArray(data)) {
            throw new Error("Le fichier doit commencer par [ et finir par ]");
        }

        if (data.length < 1) return;

        // --- RAISONNEMENT : REMONT√âE DU BAS VERS LE HAUT ---
        let indexDernier = data.length - 1;
        
        // On r√©cup√®re le point de d√©part tout en bas
        let idReference = parseInt(data[indexDernier].id);
        let dateReference = new Date(data[indexDernier].date);

        // On remonte vers le haut pour dater les nouveaux messages
        for (let i = indexDernier - 1; i >= 0; i--) {
            idReference++; 
            dateReference.setDate(dateReference.getDate() + 1);

            data[i].id = idReference;
            
            // Formatage YYYY-MM-DD
            let annee = dateReference.getFullYear();
            let mois = String(dateReference.getMonth() + 1).padStart(2, '0');
            let jour = String(dateReference.getDate()).padStart(2, '0');
            data[i].date = `${annee}-${mois}-${jour}`;
        }

        // --- G√âN√âRATION DU FICHIER PROPRE ---
        const jsonPropre = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonPropre], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "data.json";
        a.click();

    } catch (err) {
        // --- SIGNALEMENT DE L'ERREUR ---
        zoneErreur.innerHTML = "<strong>‚ö†Ô∏è ERREUR DANS LE FICHIER :</strong><br>" + err.message;
        
        if (err.message.includes("position")) {
            zoneErreur.innerHTML += "<br><br><em>Conseil : V√©rifiez les virgules entre les messages <code>}, {</code> et assurez-vous que tous les textes sont bien entre guillemets.</em>";
        }
        zoneErreur.style.display = 'block';
    }
}
</script>

</body>
</html>
