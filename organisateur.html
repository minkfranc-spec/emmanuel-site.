<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>EMMANUEL | Organisateur & Signalement</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lora', serif; background: #fdfdfd; padding: 20px; text-align: center; }
        .box { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 15px; border-top: 8px solid #d4af37; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { font-family: 'Montserrat', sans-serif; color: #1a1a1a; text-transform: uppercase; }
        textarea { width: 100%; height: 400px; font-family: monospace; padding: 15px; border: 1px solid #ccc; border-radius: 8px; background: #fafafa; outline-color: #d4af37; }
        .btn { background: #1a1a1a; color: white; padding: 15px 35px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        .btn:hover { background: #d4af37; transform: translateY(-2px); }
        .error-msg { display: none; margin-top: 20px; padding: 15px; background: #ffebee; color: #c62828; border-radius: 8px; border-left: 5px solid #ef5350; text-align: left; font-family: monospace; }
    </style>
</head>
<body>

<div class="box">
    <h1>üèõÔ∏è Organisateur Signal√©tique</h1>
    <p>Le script part du <strong>dernier ID en bas</strong> et remonte vers le haut.</p>
    
    <textarea id="jsonInput" placeholder="Collez votre code JSON ici..."></textarea>
    
    <button class="btn" onclick="organiser()">‚ö° SYNCHRONISER ET V√âRIFIER</button>
    
    <div id="errorBox" class="error-msg"></div>
</div>

<script>
function organiser() {
    const inputField = document.getElementById('jsonInput');
    const errorBox = document.getElementById('errorBox');
    errorBox.style.display = 'none';

    try {
        let data = JSON.parse(inputField.value);
        
        if (data.length === 0) return;

        // --- LOGIQUE : BAS VERS LE HAUT ---
        let dernierIndex = data.length - 1;
        let idActuel = parseInt(data[dernierIndex].id);
        let dateActuelle = new Date(data[dernierIndex].date);

        for (let i = dernierIndex - 1; i >= 0; i--) {
            idActuel++;
            dateActuelle.setDate(dateActuelle.getDate() + 1);

            data[i].id = idActuel;
            
            // Formatage date YYYY-MM-DD
            let y = dateActuelle.getFullYear();
            let m = String(dateActuelle.getMonth() + 1).padStart(2, '0');
            let d = String(dateActuelle.getDate()).padStart(2, '0');
            data[i].date = `${y}-${m}-${d}`;
        }

        // --- EXPORTATION ---
        const finalJson = JSON.stringify(data, null, 2);
        const blob = new Blob([finalJson], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "data.json";
        a.click();

    } catch (e) {
        // --- SIGNALEMENT DE L'ERREUR ---
        errorBox.innerHTML = "<strong>‚ùå ERREUR D√âTECT√âE :</strong><br>" + e.message + 
        "<br><br><small>Astuce : V√©rifiez s'il ne manque pas une virgule entre deux messages ou si un guillemet est rest√© ouvert.</small>";
        errorBox.style.display = 'block';
    }
}
</script>

</body>
</html>
