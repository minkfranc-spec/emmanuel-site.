<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMMANUEL | Organisateur & R√©parateur JSON</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lora', serif; background: #fdfdfd; color: #2c3e50; margin: 0; padding: 20px; text-align: center; }
        .box { max-width: 900px; margin: 20px auto; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); border-top: 6px solid #d4af37; }
        h1 { font-family: 'Montserrat', sans-serif; text-transform: uppercase; font-weight: 900; color: #1a1a1a; margin-bottom: 10px; }
        .status-bar { background: #f1f1f1; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9em; font-weight: bold; color: #d4af37; }
        textarea { width: 100%; height: 400px; border-radius: 10px; border: 1px solid #ddd; padding: 15px; font-family: 'Courier New', monospace; font-size: 13px; outline-color: #d4af37; background: #fafafa; }
        .btn-group { margin-top: 25px; }
        .btn-propulser { font-family: 'Montserrat', sans-serif; background: #1a1a1a; color: white; padding: 18px 45px; border-radius: 50px; border: none; cursor: pointer; font-weight: 700; text-transform: uppercase; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-propulser:hover { background: #d4af37; transform: scale(1.02); }
        .footer-note { font-size: 0.8em; color: #95a5a6; margin-top: 20px; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="box">
        <h1>üöÄ Super-Organisateur</h1>
        <div class="status-bar">üõ†Ô∏è Nettoyage auto + Correction virgules + Chronologie</div>
        
        <textarea id="jsonInput" placeholder="Collez votre code JSON ici (m√™me s'il y a des erreurs de virgules)..."></textarea>
        
        <div class="btn-group">
            <button class="btn-propulser" onclick="nettoyerEtPropulser()">‚ú® R√©parer et Synchroniser</button>
        </div>
        
        <div class="footer-note">Le fichier data.json sera g√©n√©r√© parfaitement propre.</div>
    </div>

    <script>
        function nettoyerEtPropulser() {
            let texteBrut = document.getElementById('jsonInput').value.trim();
            
            try {
                // √âTAPE 1 : Nettoyage "Barbare" pour corriger les erreurs de saisie
                // On retire les virgules tra√Ænantes juste avant les crochets ou accolades fermantes
                texteBrut = texteBrut.replace(/,\s*([\]}])/g, '$1');
                
                // √âTAPE 2 : Analyse du JSON
                let data = JSON.parse(texteBrut);
                
                if (data.length === 0) { alert("Le fichier est vide !"); return; }

                // √âTAPE 3 : Logique de Chronologie (Remont√©e du bas vers le haut)
                let dernierIndex = data.length - 1;
                let idActuel = parseInt(data[dernierIndex].id);
                let dateActuelle = new Date(data[dernierIndex].date);

                for (let i = dernierIndex - 1; i >= 0; i--) {
                    idActuel++;
                    dateActuelle.setDate(dateActuelle.getDate() + 1);

                    data[i].id = idActuel;
                    
                    let y = dateActuelle.getFullYear();
                    let m = String(dateActuelle.getMonth() + 1).padStart(2, '0');
                    let d = String(dateActuelle.getDate()).padStart(2, '0');
                    data[i].date = `${y}-${m}-${d}`;
                }

                // √âTAPE 4 : Reconstruction d'un JSON parfait (Beautify)
                // JSON.stringify avec 2 espaces d'indentation remet toutes les accolades √† leur place
                const propreJSON = JSON.stringify(data, null, 2);
                
                // √âTAPE 5 : T√©l√©chargement
                const blob = new Blob([propreJSON], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "data.json";
                a.click();

            } catch (e) {
                console.error(e);
                alert("‚ùå Erreur critique : Le JSON est trop endommag√© pour √™tre r√©par√© automatiquement. V√©rifiez qu'il ne manque pas un crochet [ ou ] au tout d√©but ou √† la fin.");
            }
        }
    </script>
</body>
</html>
